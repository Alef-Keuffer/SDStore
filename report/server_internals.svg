<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="596px" preserveAspectRatio="none" style="width:848px;height:596px;background:#FFFFFF;" version="1.1" viewBox="0 0 848 596" width="848px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="40" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="146" x="351" y="550"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136" x="356" y="574.8467">out of listening loop</text><rect fill="#F1F1F1" height="436.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="834.27" x="7" y="7"/><rect fill="#FFFFFF" height="407.8906" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="832.27" x="8" y="34.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="7" x2="841.27" y1="33.2969" y2="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="378.135" y="24.9951">listening loop</text><ellipse cx="462.05" cy="54.2969" fill="#222222" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#F1F1F1" height="40" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="384.05" y="101.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="389.05" y="126.1436">blocked on FIFO read</text><g id="lloop.pqueue"><rect fill="#F1F1F1" height="68.8906" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="277" x="323.55" y="364.2969"/><line style="stroke:#181818;stroke-width:0.5;" x1="323.55" x2="600.55" y1="390.5938" y2="390.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="409.55" y="382.292">process queue</text><ellipse cx="334.05" cy="404.3906" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="244" x="341.55" y="408.5889">execute any tasks that are possible</text><ellipse cx="334.05" cy="420.6875" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="341.55" y="424.8857">send "processing" here</text></g><rect fill="#F1F1F1" height="133.4844" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="649.5" x="137.55" y="194.2969"/><rect fill="#FFFFFF" height="105.1875" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="647.5" x="138.55" y="221.5938"/><line style="stroke:#181818;stroke-width:0.5;" x1="137.55" x2="787.05" y1="220.5938" y2="220.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124" x="400.3" y="212.292">process message</text><g id="lloop.pmes.status"><rect fill="#F1F1F1" height="52.5938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="174" x="149.55" y="248.5938"/><line style="stroke:#181818;stroke-width:0.5;" x1="149.55" x2="323.55" y1="274.8906" y2="274.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="215.05" y="266.5889">status</text><ellipse cx="160.05" cy="288.6875" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="167.55" y="292.8857">send status to client</text></g><g id="lloop.pmes.procfile"><rect fill="#F1F1F1" height="85.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159" x="342.05" y="232.5938"/><line style="stroke:#181818;stroke-width:0.5;" x1="342.05" x2="501.05" y1="258.8906" y2="258.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="394.05" y="250.5889">proc-file</text><ellipse cx="352.55" cy="272.6875" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="360.05" y="276.8857">proc-file</text><ellipse cx="352.55" cy="288.9844" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="360.05" y="293.1826">add task to queue</text><ellipse cx="352.55" cy="305.2813" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="360.05" y="309.4795">send "pending"</text></g><g id="lloop.pmes.finished_task"><rect fill="#F1F1F1" height="68.8906" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="259" x="519.05" y="240.5938"/><line style="stroke:#181818;stroke-width:0.5;" x1="519.05" x2="778.05" y1="266.8906" y2="266.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="603.55" y="258.5889">finished_task</text><ellipse cx="529.55" cy="280.6875" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="537.05" y="284.8857">update running info</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="239" x="524.05" y="301.1826">(monitor already sent "completed")</text></g><!--MD5=[9cab67c1658621a5f0ab8925afbfc4d1]
link *start*lloop to fblock--><g id="link_*start*lloop_fblock"><path d="M462.05,64.3369 C462.05,72.4869 462.05,84.8569 462.05,95.8969 " fill="none" id="*start*lloop-to-fblock" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="462.05,101.1869,466.05,92.1869,462.05,96.1869,458.05,92.1869,462.05,101.1869" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[3fcfc0c3f476e413e60df4facbb3fb5d]
link fblock to pmes--><g id="link_fblock_pmes"><path d="M462.05,141.4169 C462.05,153.9869 462.05,171.2969 462.05,188.8069 " fill="none" id="fblock-to-pmes" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="462.05,194.2469,466.05,185.2469,462.05,189.2469,458.05,185.2469,462.05,194.2469" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="463.05" y="172.3638">has data</text></g><!--MD5=[5efc9a4e4c037c5762523f0451d985dc]
link pmes to pqueue--><g id="link_pmes_pqueue"><path d="M462.05,327.4069 C462.05,338.2769 462.05,349.2369 462.05,359.1569 " fill="none" id="pmes-to-pqueue" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="462.05,364.2469,466.05,355.2469,462.05,359.2469,458.05,355.2469,462.05,364.2469" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[987e6092593f91351240b075cfb8351b]
link pqueue to fblock--><g id="link_pqueue_fblock"><path d="M600.77,385.8669 C680.73,375.7969 770.22,357.9369 795.05,327.2969 C832.27,281.3769 832.17,240.2969 795.05,194.2969 C764.28,156.1569 633.83,137.2269 545.64,128.6169 " fill="none" id="pqueue-to-fblock" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="540.42,128.1169,549.0035,132.9463,545.3978,128.5876,549.7566,124.9819,540.42,128.1169" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[db1daee58f179c2188b9f7e94e5c8bb9]
link fblock to pqueue--><g id="link_fblock_pqueue"><path d="M383.79,124.6569 C277.79,129.6869 97.04,145.4069 56.05,194.2969 C18.08,239.5969 18,282.0669 56.05,327.2969 C89.46,366.9969 215.35,384.3469 318.2,391.9169 " fill="none" id="fblock-to-pqueue" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="323.39,392.2969,314.712,387.6393,318.4038,391.9254,314.1177,395.6172,323.39,392.2969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="57.05" y="265.3638">interrupted</text></g><!--MD5=[9725512e0d43a69d55a6dc2746c1c52a]
link lloop to olloop--><g id="link_lloop_olloop"><path d="M424,443.23 C424,484.26 424,521.53 424,544.66 " fill="none" id="lloop-to-olloop" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="424,549.66,428,540.66,424,544.66,420,540.66,424,549.66" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="432.5" y="486.0669">hasBeenInterrupted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="437.5" y="501.1997">&amp;&amp; queueIsEmpty</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="425" y="516.3325">&amp;&amp; hasNoActiveTasks</text></g><!--MD5=[532793776218f37e20d0769cb46fe192]
@startuml
hide empty description

state "listening loop" as lloop {

[*] - -> fblock

state "blocked on FIFO read" as fblock
fblock - -> pmes: has data
state "process message" as pmes {
    state status: *send status to client
    state procfile as "proc-file": *proc-file\n*add task to queue\n*send "pending"
    state finished_task : *update running info\n(monitor already sent "completed")
}

state "process queue" as pqueue: *execute any tasks that are possible\n*send "processing" here

pmes - -> pqueue
pqueue - -> fblock

fblock - -> pqueue: interrupted
}

lloop - -> olloop: hasBeenInterrupted\n&& queueIsEmpty\n&& hasNoActiveTasks
state "out of listening loop" as olloop
@enduml

PlantUML version 1.2022.4(Sat Apr 09 13:29:17 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>